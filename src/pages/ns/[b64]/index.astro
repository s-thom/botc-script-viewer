---
import ScriptViewerLayout from "../../../layouts/ScriptViewerLayout.astro";
import { decompressFromBase64 } from "../../../lib/compression";
import { MAX_AGE_SECONDS } from "../../../lib/constants";
import { decodeScript } from "../../../lib/number-store";

export const prerender = false;

const { b64 } = Astro.params;

if (!b64) {
  return Astro.rewrite("/404");
}

const bytes = await decompressFromBase64(b64, "deflate-raw");
const rawScript = decodeScript(bytes);

Astro.response.headers.set(
  "Cache-Control",
  `public, max-age=${MAX_AGE_SECONDS}`,
);
---

<ScriptViewerLayout rawScript={rawScript} />
